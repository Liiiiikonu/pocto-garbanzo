<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Research Radar — Live Materials Science Paper Discovery</title>

<!-- SEO Meta -->
<meta name="description" content="Discover trending research papers in materials science, electrocatalysis, high-entropy alloys, and AI-driven scientific discovery. Live feed powered by OpenAlex with real-time citation rankings.">
<meta name="keywords" content="research papers, materials science, electrocatalysis, high-entropy alloys, machine learning materials, AI science, OpenAlex, academic papers, citation tracking, open access research">
<meta name="author" content="Research Radar">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://liiiiikonu.github.io/pocto-garbanzo/">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:title" content="Research Radar — Live Materials Science Paper Discovery">
<meta property="og:description" content="Discover trending research papers ranked by citation impact. Real-time feed covering materials science, electrocatalysis, AI in science, and more.">
<meta property="og:url" content="https://liiiiikonu.github.io/pocto-garbanzo/">
<meta property="og:site_name" content="Research Radar">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://liiiiikonu.github.io/pocto-garbanzo/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:alt" content="Research Radar — editorial research intelligence platform">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Research Radar — Live Materials Science Paper Discovery">
<meta name="twitter:description" content="Discover trending research papers ranked by citation impact. Real-time feed powered by OpenAlex.">
<meta name="twitter:image" content="https://liiiiikonu.github.io/pocto-garbanzo/og-image.png">
<meta name="twitter:image:alt" content="Research Radar — editorial research intelligence platform">

<!-- Theme -->
<meta name="theme-color" content="#c8a47e">
<meta name="color-scheme" content="dark">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='4' fill='%23c8a47e'/><circle cx='16' cy='16' r='3.5' fill='%23111'/></svg>">

<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Research Radar",
  "url": "https://liiiiikonu.github.io/pocto-garbanzo/",
  "description": "Live research paper discovery platform covering materials science, electrocatalysis, high-entropy alloys, and AI-driven scientific discovery.",
  "applicationCategory": "EducationalApplication",
  "operatingSystem": "Any",
  "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"},
  "author": {"@type": "Organization", "name": "Research Radar"}
}
</script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Newsreader:opsz,wght@6..72,400;6..72,500;6..72,600;6..72,700&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #101010;
  --bg-raised: #161616;
  --bg-elevated: #1c1c1c;
  --bg-overlay: #242424;
  --border-subtle: rgba(255,255,255,0.055);
  --border: rgba(255,255,255,0.09);
  --border-strong: rgba(255,255,255,0.15);
  --text-1: #e0ddd8;
  --text-2: #a09a90;
  --text-3: #706b63;
  --text-4: #4a4740;
  --accent: #c8a47e;
  --accent-dim: rgba(200,164,126,0.1);
  --accent-mid: rgba(200,164,126,0.22);
  --steel: #7a9bb5;
  --steel-dim: rgba(122,155,181,0.1);
  --sage: #6b9e78;
  --sage-dim: rgba(107,158,120,0.1);
  --coral: #b87060;
  --coral-dim: rgba(184,112,96,0.1);
  --error: #b85555;
  --error-dim: rgba(184,85,85,0.1);
  --sidebar-w: 264px;
}

*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}

body {
  font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background:var(--bg);
  color:var(--text-1);
  min-height:100vh;
  line-height:1.55;
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* ── Grain ── */
.grain {
  position:fixed;inset:0;z-index:9999;pointer-events:none;opacity:0.028;
  background:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  background-size:200px 200px;
}

/* ── Topbar ── */
.topbar {
  position:sticky;top:0;z-index:100;
  height:52px;
  display:flex;align-items:center;gap:1rem;
  padding:0 1.5rem;
  background:rgba(16,16,16,0.88);
  backdrop-filter:blur(16px) saturate(1.4);
  -webkit-backdrop-filter:blur(16px) saturate(1.4);
  border-bottom:1px solid var(--border-subtle);
}

.topbar-brand {
  display:flex;align-items:center;gap:0.6rem;
  flex-shrink:0;
}

.wordmark {
  font-family:'Newsreader',Georgia,serif;
  font-size:1.05rem;font-weight:700;
  letter-spacing:-0.03em;
  color:var(--text-1);
}

.status-dot {
  width:6px;height:6px;border-radius:50%;
  background:var(--sage);
  box-shadow:0 0 6px rgba(107,158,120,0.5);
  animation:pulse 3s ease-in-out infinite;
}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

.topbar-search {
  flex:1;max-width:400px;position:relative;
}

.topbar-search input {
  width:100%;
  background:var(--bg-raised);
  border:1px solid var(--border);
  color:var(--text-1);
  font:0.8rem/1 'Inter',sans-serif;
  padding:0.5rem 3rem 0.5rem 0.75rem;
  border-radius:3px;
  outline:none;
  transition:border-color 0.2s;
}
.topbar-search input::placeholder{color:var(--text-4)}
.topbar-search input:focus{border-color:var(--accent)}

.topbar-search kbd {
  position:absolute;right:0.5rem;top:50%;transform:translateY(-50%);
  font-family:'JetBrains Mono',monospace;font-size:0.6rem;
  color:var(--text-4);
  background:var(--bg-elevated);
  border:1px solid var(--border);
  padding:0.1rem 0.35rem;border-radius:2px;
  pointer-events:none;
}

.topbar-actions {
  display:flex;align-items:center;gap:0.6rem;
  margin-left:auto;flex-shrink:0;
}

.topbar-actions select {
  background:var(--bg-raised);border:1px solid var(--border);
  color:var(--text-2);font:0.75rem/1 'Inter',sans-serif;
  padding:0.35rem 0.5rem;border-radius:3px;cursor:pointer;
  outline:none;transition:border-color 0.2s;
  -webkit-appearance:none;appearance:none;
}
.topbar-actions select:hover{border-color:var(--border-strong)}
.topbar-actions select:focus{border-color:var(--accent)}

.topbar-timer {
  font-family:'JetBrains Mono',monospace;
  font-size:0.68rem;color:var(--text-4);
  min-width:36px;text-align:right;
}

.topbar-btn {
  background:none;border:1px solid var(--border);
  color:var(--text-3);
  width:28px;height:28px;border-radius:3px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;transition:all 0.15s;font-size:0.8rem;
}
.topbar-btn:hover{border-color:var(--border-strong);color:var(--text-2)}
.topbar-btn:disabled{opacity:0.3;cursor:not-allowed}

.sidebar-toggle {
  display:none;
  background:none;border:1px solid var(--border);
  color:var(--text-3);
  width:28px;height:28px;border-radius:3px;
  align-items:center;justify-content:center;
  cursor:pointer;font-size:1rem;line-height:1;
}

/* ── Layout ── */
.layout {
  display:flex;min-height:calc(100vh - 52px);
}

/* ── Sidebar ── */
.sidebar {
  width:var(--sidebar-w);flex-shrink:0;
  border-right:1px solid var(--border-subtle);
  background:var(--bg-raised);
  padding:1.25rem 0;
  position:sticky;top:52px;
  height:calc(100vh - 52px);
  overflow-y:auto;
  scrollbar-width:thin;
  scrollbar-color:var(--border) transparent;
}

.sidebar-section {
  padding:0 1.25rem;
  margin-bottom:1.5rem;
}

.sidebar-heading {
  font-size:0.62rem;font-weight:600;
  text-transform:uppercase;letter-spacing:0.1em;
  color:var(--text-4);
  margin-bottom:0.65rem;
  display:flex;align-items:center;gap:0.5rem;
}
.sidebar-heading::after {
  content:'';flex:1;height:1px;
  background:var(--border-subtle);
}

/* Topics */
.topic-item {
  display:flex;align-items:center;justify-content:space-between;
  width:100%;
  padding:0.45rem 0.65rem;margin-bottom:1px;
  background:none;border:none;border-left:2px solid transparent;
  color:var(--text-2);font:0.8rem/1.3 'Inter',sans-serif;
  cursor:pointer;transition:all 0.15s;
  text-align:left;border-radius:0 2px 2px 0;
}
.topic-item:hover {
  color:var(--text-1);
  background:var(--bg-elevated);
}
.topic-item.active {
  border-left-color:var(--accent);
  color:var(--text-1);
  background:var(--accent-dim);
}
.topic-item:disabled{opacity:0.3;cursor:not-allowed}

.topic-name{font-weight:500}
.topic-field{font-size:0.65rem;color:var(--text-4);flex-shrink:0}

/* Sidebar metrics */
.metrics-grid {
  display:grid;grid-template-columns:1fr 1fr;gap:0.4rem;
}

.metric {
  padding:0.5rem;
  background:var(--bg);
  border:1px solid var(--border-subtle);
  border-radius:2px;
}

.metric-value {
  display:block;
  font-family:'JetBrains Mono',monospace;
  font-size:1.05rem;font-weight:500;
  color:var(--text-1);
  font-variant-numeric:tabular-nums;
}

.metric-label {
  font-size:0.6rem;
  text-transform:uppercase;letter-spacing:0.06em;
  color:var(--text-4);
  margin-top:0.1rem;display:block;
}

/* Sidebar sources */
.source-item {
  display:flex;align-items:center;justify-content:space-between;
  padding:0.3rem 0;
  border-bottom:1px solid var(--border-subtle);
  font-size:0.75rem;
}
.source-item:last-child{border-bottom:none}
.source-name{color:var(--text-2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;margin-right:0.5rem}
.source-count{font-family:'JetBrains Mono',monospace;font-size:0.68rem;color:var(--text-4);flex-shrink:0}

/* Distribution chart */
.dist-chart {
  display:flex;align-items:flex-end;gap:2px;
  height:36px;padding-top:0.35rem;
}
.dist-bar {
  flex:1;min-width:0;
  background:var(--accent);opacity:0.35;
  border-radius:1px 1px 0 0;
  transition:opacity 0.2s,height 0.4s ease;
}
.dist-bar:hover{opacity:0.7}

/* Sidebar filters */
.filter-row-sidebar {
  display:flex;align-items:center;gap:0.35rem;
  margin-bottom:0.6rem;
}

.filter-select {
  flex:1;
  background:var(--bg);border:1px solid var(--border);
  color:var(--text-2);font:0.72rem/1 'Inter',sans-serif;
  padding:0.35rem 0.4rem;border-radius:2px;
  cursor:pointer;outline:none;
  transition:border-color 0.15s;
}
.filter-select:hover{border-color:var(--border-strong)}
.filter-select:focus{border-color:var(--accent)}

.filter-sep{color:var(--text-4);font-size:0.7rem}

.filter-toggle {
  display:flex;align-items:center;gap:0.4rem;
  font-size:0.75rem;color:var(--text-3);
  cursor:pointer;transition:color 0.15s;
}
.filter-toggle:hover{color:var(--text-2)}
.filter-toggle input{accent-color:var(--accent);width:13px;height:13px;cursor:pointer}

/* ── Main Feed ── */
.feed-main {
  flex:1;min-width:0;
  padding:1.5rem 2rem 4rem;
  max-width:840px;
}

.feed-header {
  display:none;align-items:center;justify-content:space-between;
  margin-bottom:1.25rem;
  padding-bottom:0.75rem;
  border-bottom:1px solid var(--border-subtle);
}
.feed-header.visible{display:flex}

.feed-header-count {
  font-size:0.78rem;color:var(--text-3);
}
.feed-header-count strong {
  font-weight:600;color:var(--text-2);
}

.feed-header-sort {
  font-size:0.7rem;color:var(--text-4);
  font-family:'JetBrains Mono',monospace;
}

/* Error */
.error-banner {
  display:none;
  margin-bottom:1rem;
  padding:0.6rem 0.8rem;
  background:var(--error-dim);
  border:1px solid rgba(184,85,85,0.2);
  border-radius:2px;
  font-size:0.8rem;color:var(--error);
}

/* ── Paper — Featured ── */
.paper--featured {
  position:relative;
  padding:1.75rem 0 1.5rem;
  margin-bottom:0.25rem;
  border-bottom:1px solid var(--border);
}

.paper--featured .paper-rank {
  font-family:'Newsreader',serif;
  font-size:4.5rem;font-weight:700;
  color:rgba(255,255,255,0.04);
  position:absolute;top:0.75rem;right:0;
  line-height:1;pointer-events:none;
  font-variant-numeric:tabular-nums;
}

.paper--featured .paper-source {
  font-size:0.72rem;font-weight:500;
  color:var(--accent);
  text-transform:uppercase;letter-spacing:0.04em;
  margin-bottom:0.45rem;display:block;
}

.paper--featured .paper-title {
  font-family:'Newsreader',Georgia,serif;
  font-size:1.55rem;font-weight:700;
  line-height:1.3;letter-spacing:-0.025em;
  margin-bottom:0.55rem;
}
.paper--featured .paper-title a {
  color:var(--text-1);text-decoration:none;
  transition:color 0.15s;
}
.paper--featured .paper-title a:hover{color:var(--accent)}

.paper--featured .paper-authors {
  font-size:0.78rem;color:var(--text-3);
  margin-bottom:0.5rem;
}

.paper--featured .paper-date {
  font-family:'JetBrains Mono',monospace;
  font-size:0.68rem;color:var(--text-4);
}

.paper--featured .paper-abstract {
  font-size:0.9rem;line-height:1.75;
  color:var(--text-2);
  margin-top:0.85rem;
  max-width:620px;
}

.paper--featured .paper-abstract::first-letter {
  font-family:'Newsreader',Georgia,serif;
  font-size:2.6em;float:left;
  line-height:0.82;
  margin-right:0.06em;margin-top:0.06em;
  color:var(--accent);font-weight:600;
}

.paper--featured .paper-indicators {
  display:flex;align-items:center;gap:1rem;
  margin-top:1rem;flex-wrap:wrap;
}

/* Momentum */
.momentum {
  display:flex;align-items:center;gap:0.5rem;
}

.momentum-label {
  font-size:0.62rem;font-weight:500;
  text-transform:uppercase;letter-spacing:0.06em;
  color:var(--text-4);
}

.momentum-score {
  font-family:'JetBrains Mono',monospace;
  font-size:0.85rem;font-weight:500;
  color:var(--accent);
  min-width:1.6em;
}

.momentum-bar {
  width:80px;height:3px;
  background:var(--bg-overlay);
  border-radius:1px;overflow:hidden;
}
.momentum-fill {
  height:100%;border-radius:1px;
  background:var(--accent);
  transition:width 0.6s ease;
}

.indicator-sep {
  width:1px;height:14px;background:var(--border);
}

.indicator-cite {
  font-family:'JetBrains Mono',monospace;
  font-size:0.75rem;color:var(--text-3);
}

.indicator-velocity {
  font-family:'JetBrains Mono',monospace;
  font-size:0.68rem;color:var(--text-4);
}

.indicator-oa {
  font-size:0.65rem;font-weight:600;
  color:var(--sage);
  text-transform:uppercase;letter-spacing:0.04em;
}

/* ── Paper — Compact Row (2-up) ── */
.paper-row {
  display:grid;grid-template-columns:1fr 1fr;gap:1px;
  margin-bottom:0.25rem;
  background:var(--border-subtle);
}

.paper--compact {
  padding:1.1rem 1.25rem;
  background:var(--bg);
  transition:background 0.15s;
}
.paper--compact:hover{background:var(--bg-raised)}

.paper--compact .paper-rank {
  font-family:'JetBrains Mono',monospace;
  font-size:0.65rem;color:var(--text-4);
  margin-bottom:0.3rem;
  font-variant-numeric:tabular-nums;
}

.paper--compact .paper-title {
  font-family:'Newsreader',Georgia,serif;
  font-size:1.02rem;font-weight:600;
  line-height:1.35;letter-spacing:-0.015em;
  margin-bottom:0.3rem;
}
.paper--compact .paper-title a {
  color:var(--text-1);text-decoration:none;
  transition:color 0.15s;
}
.paper--compact .paper-title a:hover{color:var(--accent)}

.paper--compact .paper-meta-line {
  font-size:0.7rem;color:var(--text-3);
  margin-bottom:0.25rem;
}

.paper--compact .paper-abstract {
  font-size:0.8rem;color:var(--text-2);
  line-height:1.6;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
}

.paper--compact .paper-indicators {
  display:flex;align-items:center;gap:0.6rem;
  margin-top:0.6rem;
}

/* ── Insight Block ── */
.insight-block {
  padding:1rem 0;
  margin:0.25rem 0;
  border-bottom:1px solid var(--border-subtle);
  border-top:1px solid var(--border-subtle);
  background:var(--bg-raised);
  margin-left:-2rem;margin-right:-2rem;
  padding-left:2rem;padding-right:2rem;
}

.insight-label {
  font-size:0.6rem;font-weight:600;
  text-transform:uppercase;letter-spacing:0.1em;
  color:var(--accent);
  margin-bottom:0.35rem;display:block;
}

.insight-text {
  font-size:0.82rem;color:var(--text-2);
  line-height:1.6;
}
.insight-text strong{color:var(--text-1);font-weight:600}

/* ── Paper — Standard ── */
.paper--standard {
  display:flex;align-items:flex-start;gap:1rem;
  padding:1rem 0;
  border-bottom:1px solid var(--border-subtle);
  transition:all 0.15s;
  position:relative;
}
.paper--standard::before {
  content:'';position:absolute;
  left:-2rem;top:0;bottom:0;width:2px;
  background:var(--accent);opacity:0;
  transition:opacity 0.15s;
}
.paper--standard:hover::before{opacity:1}
.paper--standard:hover{padding-left:0.4rem}

.paper--standard .paper-rank {
  font-family:'JetBrains Mono',monospace;
  font-size:0.72rem;font-weight:500;
  color:var(--text-4);
  min-width:1.6rem;text-align:right;
  padding-top:0.15rem;
  font-variant-numeric:tabular-nums;
  flex-shrink:0;
}

.paper--standard .paper-content{flex:1;min-width:0}

.paper--standard .paper-meta-line {
  font-size:0.68rem;color:var(--text-3);
  margin-bottom:0.2rem;
}
.paper--standard .paper-meta-line .src{color:var(--accent);font-weight:500}

.paper--standard .paper-title {
  font-family:'Newsreader',Georgia,serif;
  font-size:1.02rem;font-weight:600;
  line-height:1.35;letter-spacing:-0.015em;
  margin-bottom:0.2rem;
}
.paper--standard .paper-title a {
  color:var(--text-1);text-decoration:none;
  transition:color 0.15s;
}
.paper--standard .paper-title a:hover{color:var(--accent)}

.paper--standard .paper-authors {
  font-size:0.72rem;color:var(--text-4);
  margin-bottom:0.3rem;
}

.paper--standard .paper-abstract {
  font-size:0.8rem;color:var(--text-2);
  line-height:1.6;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
}

.paper--standard .paper-indicators {
  display:flex;align-items:center;gap:0.6rem;
  margin-top:0.5rem;
}

.paper--standard .paper-momentum {
  flex-shrink:0;text-align:right;
  padding-top:0.15rem;
}
.paper--standard .paper-momentum .momentum-score {
  font-family:'JetBrains Mono',monospace;
  font-size:0.82rem;font-weight:500;
  color:var(--accent);
}
.paper--standard .paper-momentum .momentum-label {
  font-size:0.55rem;color:var(--text-4);
  text-transform:uppercase;letter-spacing:0.05em;
  margin-top:0.1rem;display:block;
}

/* ── Empty / Skeleton ── */
.empty-state {
  text-align:center;padding:5rem 1rem;
  color:var(--text-4);font-size:0.9rem;
}
.empty-state .empty-icon {
  width:40px;height:40px;margin:0 auto 1rem;
  border:1px solid var(--border);border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  color:var(--text-4);font-size:1.1rem;
}

.skel{padding:1.25rem 0;border-bottom:1px solid var(--border-subtle)}
.skel-featured{padding:2rem 0}
.skel-line {
  height:10px;border-radius:2px;
  background:linear-gradient(90deg,var(--bg-elevated) 25%,rgba(255,255,255,0.025) 50%,var(--bg-elevated) 75%);
  background-size:200% 100%;animation:shimmer 1.8s ease infinite;
  margin-bottom:0.55rem;
}
.skel-line:nth-child(1){width:20%;height:8px}
.skel-line:nth-child(2){width:70%}
.skel-line:nth-child(3){width:50%}
.skel-line:nth-child(4){width:85%;margin-bottom:0}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* ── Footer ── */
footer {
  padding:2rem 1.5rem;
  font-size:0.68rem;color:var(--text-4);
  text-align:center;
  border-top:1px solid var(--border-subtle);
}
footer a{color:var(--accent);text-decoration:none;transition:color 0.15s}
footer a:hover{color:var(--text-2)}

/* ── Responsive ── */
@media(max-width:900px) {
  .sidebar{
    position:fixed;left:-300px;top:52px;bottom:0;
    width:280px;z-index:200;
    transition:left 0.25s ease;
    box-shadow:none;
  }
  .sidebar.open{left:0;box-shadow:8px 0 24px rgba(0,0,0,0.4)}
  .sidebar-toggle{display:flex}
  .sidebar-overlay {
    display:none;position:fixed;inset:0;top:52px;
    z-index:199;background:rgba(0,0,0,0.5);
  }
  .sidebar-overlay.visible{display:block}
  .feed-main{padding:1.25rem 1rem 3rem}
  .paper-row{grid-template-columns:1fr}
  .insight-block{margin-left:-1rem;margin-right:-1rem;padding-left:1rem;padding-right:1rem}
  .paper--standard::before{left:-1rem}
  .paper--featured .paper-title{font-size:1.3rem}
  .topbar-search{max-width:260px}
}

@media(max-width:560px) {
  .topbar{padding:0 0.75rem;gap:0.5rem}
  .wordmark{font-size:0.9rem}
  .topbar-search{max-width:180px}
  .topbar-search kbd{display:none}
  .feed-main{padding:1rem 0.75rem 3rem}
  .paper--featured .paper-title{font-size:1.15rem}
  .paper--featured .paper-abstract{font-size:0.82rem}
  .paper--compact .paper-title{font-size:0.92rem}
  .metrics-grid{grid-template-columns:1fr 1fr}
}

/* ── Scrollbar ── */
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
::-webkit-scrollbar-thumb:hover{background:var(--border-strong)}
::selection{background:var(--accent-mid);color:var(--text-1)}

/* ── Animations ── */
@keyframes fadeUp {
  from{opacity:0;transform:translateY(12px)}
  to{opacity:1;transform:translateY(0)}
}
.anim-in{animation:fadeUp 0.35s ease both}
</style>
</head>
<body>

<div class="grain"></div>
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<header class="topbar">
  <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">&#9776;</button>
  <div class="topbar-brand">
    <span class="wordmark">Research Radar</span>
    <span class="status-dot" title="Live — auto-refreshes every 5 min"></span>
  </div>
  <div class="topbar-search">
    <input id="searchInput" type="text" placeholder="Filter results..." autocomplete="off" />
    <kbd id="kbdHint">&#8984;K</kbd>
  </div>
  <div class="topbar-actions">
    <select id="sortSelect" title="Sort order">
      <option value="hot">By velocity</option>
      <option value="cited">By citations</option>
      <option value="recent">By date</option>
      <option value="relevant">By relevance</option>
    </select>
    <span class="topbar-timer" id="refreshTimer"></span>
    <button class="topbar-btn" id="refreshBtn" title="Refresh now">&#8635;</button>
  </div>
</header>

<div class="layout">

<aside class="sidebar" id="sidebar">

  <div class="sidebar-section">
    <h2 class="sidebar-heading">Topics</h2>
    <div id="topics"></div>
  </div>

  <div class="sidebar-section">
    <h2 class="sidebar-heading">Metrics</h2>
    <div class="metrics-grid">
      <div class="metric"><span class="metric-value" id="statPapers">&mdash;</span><span class="metric-label">Papers</span></div>
      <div class="metric"><span class="metric-value" id="statCites">&mdash;</span><span class="metric-label">Citations</span></div>
      <div class="metric"><span class="metric-value" id="statMedian">&mdash;</span><span class="metric-label">Median</span></div>
      <div class="metric"><span class="metric-value" id="statOA">&mdash;</span><span class="metric-label">Open Access</span></div>
    </div>
  </div>

  <div class="sidebar-section">
    <h2 class="sidebar-heading">Top Sources</h2>
    <div id="sourcesList"><span style="font-size:0.72rem;color:var(--text-4)">Select a topic</span></div>
  </div>

  <div class="sidebar-section">
    <h2 class="sidebar-heading">Citation Dist.</h2>
    <div class="dist-chart" id="distChart"></div>
  </div>

  <div class="sidebar-section">
    <h2 class="sidebar-heading">Filters</h2>
    <div class="filter-row-sidebar">
      <select class="filter-select" id="yearFrom"></select>
      <span class="filter-sep">&ndash;</span>
      <select class="filter-select" id="yearTo"></select>
    </div>
    <label class="filter-toggle">
      <input type="checkbox" id="oaOnly" />
      <span>Open access only</span>
    </label>
  </div>

</aside>

<main class="feed-main">
  <div class="feed-header" id="resultBar">
    <span class="feed-header-count" id="resultCount"></span>
    <span class="feed-header-sort" id="resultSort"></span>
  </div>
  <div class="error-banner" id="errorBanner"></div>
  <div id="feed">
    <div class="empty-state">
      <div class="empty-icon">?</div>
      <p>Select a research topic to begin.</p>
    </div>
  </div>
</main>

</div>

<footer>
  Data from <a href="https://openalex.org" target="_blank" rel="noopener">OpenAlex</a> &mdash; the open catalog of the world's scholarly works.
</footer>

<script>
// ── Config ──
const TOPICS = [
  {label:"High-Entropy Alloys", field:"Metallurgy", search:"high-entropy alloys", concepts:"C2778407723"},
  {label:"Electrocatalysis", field:"Chemistry", search:"electrocatalysis", concepts:"C159467904"},
  {label:"ML for Materials", field:"AI + MatSci", search:"machine learning materials science materials discovery"},
  {label:"AI in Science", field:"Broad AI", search:"artificial intelligence scientific discovery research"},
  {label:"Engineering Physics", field:"Physics", search:"engineering physics"},
  {label:"Trending MatSci", field:"Materials", search:"materials science", concepts:"C192562407"},
];

const OPENALEX = "https://api.openalex.org/works";
const PER_PAGE = 25, SHOW = 15, REFRESH = 5*60*1000;

// ── State ──
let activeTopic = null, loading = false, currentPapers = [], searchFilter = '';
const cache = {};
let refreshId = null, countdownId = null, refreshCountdown = 0;

// ── DOM ──
const topicsEl = document.getElementById('topics');
const feedEl = document.getElementById('feed');
const errorBanner = document.getElementById('errorBanner');
const sortSelect = document.getElementById('sortSelect');
const resultBar = document.getElementById('resultBar');
const resultCount = document.getElementById('resultCount');
const resultSort = document.getElementById('resultSort');
const refreshTimer = document.getElementById('refreshTimer');
const refreshBtn = document.getElementById('refreshBtn');
const yearFrom = document.getElementById('yearFrom');
const yearTo = document.getElementById('yearTo');
const oaOnly = document.getElementById('oaOnly');
const searchInput = document.getElementById('searchInput');
const sidebarEl = document.getElementById('sidebar');
const sidebarToggle = document.getElementById('sidebarToggle');
const sidebarOverlay = document.getElementById('sidebarOverlay');
const statPapers = document.getElementById('statPapers');
const statCites = document.getElementById('statCites');
const statMedian = document.getElementById('statMedian');
const statOA = document.getElementById('statOA');
const sourcesList = document.getElementById('sourcesList');
const distChart = document.getElementById('distChart');

// ── Init ──
(function init() {
  populateYears();
  renderTopics();
  sortSelect.addEventListener('change', () => { if (activeTopic !== null) bust() });
  yearFrom.addEventListener('change', () => { if (activeTopic !== null) bust() });
  yearTo.addEventListener('change', () => { if (activeTopic !== null) bust() });
  oaOnly.addEventListener('change', () => { if (activeTopic !== null) bust() });
  refreshBtn.addEventListener('click', () => { if (activeTopic !== null && !loading) forceRefresh() });

  // Search filter
  searchInput.addEventListener('input', () => {
    searchFilter = searchInput.value.trim().toLowerCase();
    if (currentPapers.length) renderFeed(filterPapers(currentPapers), TOPICS[activeTopic]);
  });

  // Keyboard shortcut
  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      searchInput.focus();
    }
    if (e.key === 'Escape') searchInput.blur();
  });

  // Detect platform for kbd hint
  if (navigator.platform && !navigator.platform.match(/Mac/)) {
    document.getElementById('kbdHint').textContent = 'Ctrl+K';
  }

  // Mobile sidebar
  sidebarToggle.addEventListener('click', () => {
    sidebarEl.classList.toggle('open');
    sidebarOverlay.classList.toggle('visible');
  });
  sidebarOverlay.addEventListener('click', () => {
    sidebarEl.classList.remove('open');
    sidebarOverlay.classList.remove('visible');
  });

  selectTopic(5);
})();

function bust() { delete cache[cacheKey(activeTopic)]; selectTopic(activeTopic) }

function populateYears() {
  const cur = new Date().getFullYear();
  for (let y = cur; y >= 2015; y--) {
    yearFrom.innerHTML += `<option value="${y}"${y===cur-1?' selected':''}>${y}</option>`;
    yearTo.innerHTML += `<option value="${y}"${y===cur?' selected':''}>${y}</option>`;
  }
}

function cacheKey(i) {
  return TOPICS[i].label+'|'+sortSelect.value+'|'+yearFrom.value+'-'+yearTo.value+'|'+oaOnly.checked;
}

// ── Refresh ──
function startRefresh() {
  stopRefresh();
  refreshCountdown = REFRESH / 1000;
  updateTimer();
  countdownId = setInterval(() => { refreshCountdown--; updateTimer() }, 1000);
  refreshId = setTimeout(forceRefresh, REFRESH);
}
function stopRefresh() { clearTimeout(refreshId); clearInterval(countdownId) }
function updateTimer() {
  if (refreshCountdown <= 0) { refreshTimer.textContent = '...'; return }
  const m = Math.floor(refreshCountdown/60), s = refreshCountdown%60;
  refreshTimer.textContent = m+':'+String(s).padStart(2,'0');
}
function forceRefresh() {
  if (activeTopic === null || loading) return;
  delete cache[cacheKey(activeTopic)];
  selectTopic(activeTopic);
}

// ── Topics ──
function renderTopics() {
  topicsEl.innerHTML = '';
  TOPICS.forEach((t, i) => {
    const b = document.createElement('button');
    b.className = 'topic-item';
    b.innerHTML = `<span class="topic-name">${esc(t.label)}</span><span class="topic-field">${esc(t.field)}</span>`;
    b.addEventListener('click', () => {
      selectTopic(i);
      sidebarEl.classList.remove('open');
      sidebarOverlay.classList.remove('visible');
    });
    topicsEl.appendChild(b);
  });
}

function updateTopicPills() {
  topicsEl.querySelectorAll('.topic-item').forEach((el, i) => {
    el.classList.toggle('active', i === activeTopic);
    el.disabled = loading;
  });
  refreshBtn.disabled = loading;
}

// ── Select ──
async function selectTopic(i) {
  if (loading) return;
  hideError();
  activeTopic = i;
  searchFilter = '';
  searchInput.value = '';
  const t = TOPICS[i], key = cacheKey(i);

  if (cache[key] && Date.now() - cache[key].ts < REFRESH) {
    currentPapers = cache[key].cards;
    render(cache[key].cards, t, cache[key].total);
    updateTopicPills();
    startRefresh();
    return;
  }

  loading = true;
  updateTopicPills();
  showSkeletons();

  try {
    const { papers, totalCount } = await fetchOA(t, sortSelect.value);
    cache[key] = { cards: papers, ts: Date.now(), total: totalCount };
    currentPapers = papers;
    render(papers, t, totalCount);
    startRefresh();
  } catch(e) {
    showError(e.message || 'Failed to fetch papers.');
    feedEl.innerHTML = '';
    resultBar.classList.remove('visible');
  } finally {
    loading = false;
    updateTopicPills();
  }
}

// ── OpenAlex ──
function buildUrl(t, sort) {
  const p = new URLSearchParams();
  p.set('per_page', PER_PAGE);
  p.set('mailto', 'research-radar@users.noreply.github.com');
  const fy = +yearFrom.value, ty = +yearTo.value;
  let f = `from_publication_date:${fy}-01-01,to_publication_date:${ty}-12-31,type:article|review`;
  if (t.concepts) f += `,concepts.id:${t.concepts}`;
  if (oaOnly.checked) f += `,open_access.is_oa:true`;
  p.set('filter', f);
  p.set('search', t.search);
  const sorts = {hot:'cited_by_count:desc', cited:'cited_by_count:desc', relevant:'relevance_score:desc', recent:'publication_date:desc'};
  p.set('sort', sorts[sort] || sorts.recent);
  return OPENALEX + '?' + p;
}

async function fetchOA(topic, sort) {
  const r = await fetch(buildUrl(topic, sort));
  if (!r.ok) throw new Error('OpenAlex returned ' + r.status);
  const d = await r.json(), total = d.meta?.count || 0;
  let papers = (d.results || []).map(w => {
    const au = (w.authorships||[]).slice(0,4).map(a => a.author?.display_name).filter(Boolean).join(', ');
    const suf = (w.authorships||[]).length > 4 ? ' et al.' : '';
    const url = w.doi || w.primary_location?.landing_page_url || w.ids?.openalex || '';
    const src = w.primary_location?.source?.display_name || '';
    const date = w.publication_date || '';
    let abs = '';
    if (w.abstract_inverted_index) abs = rebuildAbstract(w.abstract_inverted_index);
    const oa = w.open_access?.is_oa || false;
    const oaUrl = w.open_access?.oa_url || '';
    const cited = w.cited_by_count || 0;
    let vel = 0;
    if (date && cited > 0) {
      vel = cited / Math.max(1, (Date.now() - new Date(date)) / 864e5);
    }
    return {title:w.display_name||w.title||'Untitled', url, authors:au+suf, source:src, date, summary:abs, cited_by_count:cited, velocity:vel, is_oa:oa, oa_url:oaUrl};
  });
  if (sort === 'hot') papers.sort((a,b) => b.velocity - a.velocity);
  return { papers: papers.slice(0, SHOW), totalCount: total };
}

function rebuildAbstract(inv) {
  if (!inv) return '';
  const w = [];
  for (const [word, pos] of Object.entries(inv)) for (const p of pos) w[p] = word;
  const t = w.join(' ');
  return t.length > 500 ? t.slice(0, 500).replace(/\s\S*$/, '') + '\u2026' : t;
}

// ── Filter ──
function filterPapers(papers) {
  if (!searchFilter) return papers;
  return papers.filter(p =>
    p.title.toLowerCase().includes(searchFilter) ||
    p.authors.toLowerCase().includes(searchFilter) ||
    p.source.toLowerCase().includes(searchFilter)
  );
}

// ── Render ──
function render(cards, topic, total) {
  const filtered = filterPapers(cards);
  updateSidebar(cards);
  renderFeed(filtered, topic, total);
}

function renderFeed(cards, topic, total) {
  // Header
  if (total !== undefined) {
    resultCount.innerHTML = `<strong>${cards.length}</strong> of ${(total||0).toLocaleString()} results &middot; ${yearFrom.value}&ndash;${yearTo.value}`;
    const sortLabels = {hot:'velocity', cited:'citations', recent:'date', relevant:'relevance'};
    resultSort.textContent = 'sorted by ' + (sortLabels[sortSelect.value]||'relevance');
    resultBar.classList.add('visible');
  }

  if (!cards.length) {
    feedEl.innerHTML = '<div class="empty-state"><div class="empty-icon">?</div><p>No results found. Adjust filters or try another topic.</p></div>';
    return;
  }

  const maxVel = Math.max(...cards.map(c => c.velocity), 0.001);
  feedEl.innerHTML = '';
  let idx = 0;

  // Featured (paper #1)
  if (cards.length > 0) {
    const c = cards[0];
    const el = document.createElement('article');
    el.className = 'paper--featured anim-in';
    const link = c.is_oa && c.oa_url ? c.oa_url : c.url;
    const titleH = link ? `<a href="${esc(link)}" target="_blank" rel="noopener">${esc(c.title)}</a>` : esc(c.title);
    const mom = Math.round((c.velocity / maxVel) * 99) || 0;

    el.innerHTML = `
      <div class="paper-rank">01</div>
      <span class="paper-source">${esc(c.source)}${c.date ? ' &middot; '+fmtDate(c.date) : ''}</span>
      <h2 class="paper-title">${titleH}</h2>
      <p class="paper-authors">${esc(c.authors)}</p>
      ${c.summary ? `<p class="paper-abstract">${esc(c.summary)}</p>` : ''}
      <div class="paper-indicators">
        <div class="momentum">
          <span class="momentum-label">Momentum</span>
          <span class="momentum-score">${mom}</span>
          <div class="momentum-bar"><div class="momentum-fill" style="width:${mom}%"></div></div>
        </div>
        <span class="indicator-sep"></span>
        <span class="indicator-cite">${c.cited_by_count.toLocaleString()} citations</span>
        ${c.velocity > 0 ? `<span class="indicator-velocity">${c.velocity.toFixed(1)}/day</span>` : ''}
        ${c.is_oa ? '<span class="indicator-oa">Open Access</span>' : ''}
      </div>`;
    feedEl.appendChild(el);
    idx = 1;
  }

  // Compact 2-up (papers #2-3)
  if (cards.length >= 3) {
    const row = document.createElement('div');
    row.className = 'paper-row anim-in';
    row.style.animationDelay = '0.06s';
    for (let j = 1; j <= 2; j++) {
      const c = cards[j];
      const link = c.is_oa && c.oa_url ? c.oa_url : c.url;
      const titleH = link ? `<a href="${esc(link)}" target="_blank" rel="noopener">${esc(c.title)}</a>` : esc(c.title);
      const mom = Math.round((c.velocity / maxVel) * 99) || 0;
      const d = document.createElement('div');
      d.className = 'paper--compact';
      d.innerHTML = `
        <div class="paper-rank">${String(j+1).padStart(2,'0')}</div>
        <h3 class="paper-title">${titleH}</h3>
        <div class="paper-meta-line">${esc(c.source)}${c.date ? ' &middot; '+fmtDate(c.date) : ''}</div>
        ${c.summary ? `<p class="paper-abstract">${esc(c.summary)}</p>` : ''}
        <div class="paper-indicators">
          <span class="momentum-score" style="font-family:'JetBrains Mono',monospace;font-size:0.72rem;color:var(--accent)">M:${mom}</span>
          <span class="indicator-cite" style="font-size:0.68rem">${c.cited_by_count.toLocaleString()} cited</span>
          ${c.is_oa ? '<span class="indicator-oa">OA</span>' : ''}
        </div>`;
      row.appendChild(d);
    }
    feedEl.appendChild(row);
    idx = 3;
  } else if (cards.length === 2) {
    idx = 1;
  }

  // Insight block
  if (cards.length >= 3) {
    const oaPercent = Math.round(cards.filter(c => c.is_oa).length / cards.length * 100);
    const topSource = getTopSource(cards);
    const avgVel = (cards.reduce((s,c) => s + c.velocity, 0) / cards.length).toFixed(1);
    const ins = document.createElement('div');
    ins.className = 'insight-block anim-in';
    ins.style.animationDelay = '0.1s';
    ins.innerHTML = `
      <span class="insight-label">Signal</span>
      <p class="insight-text">${oaPercent}% open access. ${topSource ? `Leading source: <strong>${esc(topSource)}</strong>.` : ''} Average velocity: <strong>${avgVel}</strong> citations/day across ${cards.length} results.</p>`;
    feedEl.appendChild(ins);
  }

  // Remaining papers
  const remaining = cards.slice(idx);
  remaining.forEach((c, i) => {
    const rank = idx + i + 1;
    const el = document.createElement('article');
    el.className = 'paper--standard anim-in';
    el.style.animationDelay = (0.12 + i * 0.03) + 's';
    const link = c.is_oa && c.oa_url ? c.oa_url : c.url;
    const titleH = link ? `<a href="${esc(link)}" target="_blank" rel="noopener">${esc(c.title)}</a>` : esc(c.title);
    const mom = Math.round((c.velocity / maxVel) * 99) || 0;

    el.innerHTML = `
      <div class="paper-rank">${String(rank).padStart(2,'0')}</div>
      <div class="paper-content">
        <div class="paper-meta-line"><span class="src">${esc(c.source)}</span>${c.date ? ' &middot; '+fmtDate(c.date) : ''}</div>
        <h3 class="paper-title">${titleH}</h3>
        <p class="paper-authors">${esc(c.authors)}</p>
        ${c.summary ? `<p class="paper-abstract">${esc(c.summary)}</p>` : ''}
        <div class="paper-indicators">
          <span class="indicator-cite">${c.cited_by_count.toLocaleString()} citations</span>
          ${c.velocity > 0 ? `<span class="indicator-velocity">${c.velocity.toFixed(1)}/day</span>` : ''}
          ${c.is_oa ? '<span class="indicator-oa">OA</span>' : ''}
        </div>
      </div>
      <div class="paper-momentum">
        <span class="momentum-score">${mom}</span>
        <span class="momentum-label">M</span>
      </div>`;
    feedEl.appendChild(el);
  });
}

// ── Sidebar intelligence ──
function updateSidebar(cards) {
  // Metrics
  const total = cards.length;
  const cites = cards.reduce((s,c) => s + c.cited_by_count, 0);
  const sorted = [...cards].sort((a,b) => a.cited_by_count - b.cited_by_count);
  const median = total ? sorted[Math.floor(total/2)].cited_by_count : 0;
  const oaCount = cards.filter(c => c.is_oa).length;
  const oaPercent = total ? Math.round(oaCount/total*100) + '%' : '0%';

  animateNum(statPapers, total);
  animateNum(statCites, cites);
  animateNum(statMedian, median);
  statOA.textContent = oaPercent;

  // Sources
  const srcMap = {};
  cards.forEach(c => {
    if (c.source) srcMap[c.source] = (srcMap[c.source]||0) + 1;
  });
  const srcs = Object.entries(srcMap).sort((a,b) => b[1]-a[1]).slice(0,5);
  if (srcs.length) {
    sourcesList.innerHTML = srcs.map(([name,count]) =>
      `<div class="source-item"><span class="source-name">${esc(name)}</span><span class="source-count">${count}</span></div>`
    ).join('');
  } else {
    sourcesList.innerHTML = '<span style="font-size:0.72rem;color:var(--text-4)">No data</span>';
  }

  // Distribution chart
  if (cards.length) {
    const maxCite = Math.max(...cards.map(c => c.cited_by_count), 1);
    const sortedByRank = [...cards];
    distChart.innerHTML = sortedByRank.map(c => {
      const h = Math.max(2, Math.round((c.cited_by_count / maxCite) * 36));
      return `<div class="dist-bar" style="height:${h}px" title="${c.cited_by_count} citations"></div>`;
    }).join('');
  } else {
    distChart.innerHTML = '';
  }
}

function getTopSource(cards) {
  const srcMap = {};
  cards.forEach(c => { if (c.source) srcMap[c.source] = (srcMap[c.source]||0)+1 });
  const top = Object.entries(srcMap).sort((a,b) => b[1]-a[1])[0];
  return top ? top[0] : '';
}

function animateNum(el, target) {
  const start = parseInt(el.textContent) || 0;
  if (start === target) { el.textContent = target.toLocaleString(); return }
  const dur = 400, t0 = performance.now();
  function tick(now) {
    const p = Math.min(1, (now-t0)/dur);
    const eased = 1 - Math.pow(1-p, 3);
    el.textContent = Math.round(start + (target-start) * eased).toLocaleString();
    if (p < 1) requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
}

// ── Skeleton ──
function showSkeletons() {
  resultBar.classList.remove('visible');
  feedEl.innerHTML = '';
  const f = document.createElement('div');
  f.className = 'skel skel-featured';
  f.innerHTML = '<div class="skel-line"></div><div class="skel-line"></div><div class="skel-line"></div><div class="skel-line"></div>';
  feedEl.appendChild(f);
  for (let i = 0; i < 5; i++) {
    const s = document.createElement('div');
    s.className = 'skel';
    s.innerHTML = '<div class="skel-line"></div><div class="skel-line"></div><div class="skel-line"></div><div class="skel-line"></div>';
    feedEl.appendChild(s);
  }
}

// ── Error ──
function showError(m) { errorBanner.textContent = m; errorBanner.style.display = 'block' }
function hideError() { errorBanner.style.display = 'none' }

// ── Util ──
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML }

function fmtDate(d) {
  if (!d) return '';
  return new Date(d).toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
}
</script>
</body>
</html>
